import sqlite3
import random
import pandas as pd
from math import sqrt

# to run on Kaggle
sql_conn = sqlite3.connect('../input/database.sqlite')
# to run localy
#sql_conn = sqlite3.connect('database.sqlite')

#copy the list output from extract test data
testAuthors = ['---CitationNeeded---', '---D', '---E', '---JustMe---', '---N-E-P-M-A-K---', '---ZeeCaptain---', '---_-o-', '---__--', '---______________--', '---annon---', '---david', '---fuckyou---', '---o_n', '---sniff---', '--23---', '--4-8-15-16-23-42', '--404--', '--ATX--', '--Anthony--', '--Caius--', '--Danny', '--FrenchyBoy--', '--Greg--', '--Kai--', '--LOS--', '--Lust--', '--MxM--', '--Petrichor--', '--Ping--', '--Poot--', '--Repetitive--', '--STACK--', '--Satan--', '--Shadowbanned--', '--Sharpe--', '--Sigma--', '--TERRORIST--', '--TheDoctor--', '--V', '--Vespertine--', '--Void--', '--Xochiquetzal--', '--YouLostTheGame--', '--_--_--_--_--_--_', '--caddish--', '--carter--', '--cheese--', '--comadose', '--cunt', '--fap--', '--focus--', '--frymaster--', '--geode', '--his_dudeness--', '--hundy', '--hypnos--', '--jp--', '--liveitup', '--lolwutroflwaffle--', '--majin--', '--o', '--o_V_o--', '--o__O--', '--recursive', '--redbeard--', '--seaker--', '--shera--', '--smokeandmirrors--', '--somethingnew--', '--theriverstyx--', '--tomo', '--treandoge--', '--u-s-e-r-n-a-m-e--', '-01baka-', '-100-Broken-Windows-', '-127', '-13-', '-14k-', '-1683-', '-1921-', '-1_1-', '-1points', '-2vsU-', '-3-', '-311-', '-33rpm', '-34', '-36-', '-3E-', '-3rdperson', '-4-8-15-16-23-42-', '-45', '-500-', '-5FDP-', '-5m', '-6-6-6-', '-73-', '-7_', '-888-', '-907-', '-9999px', '-A1', '-AC-', '-ADEPT-', '-ANewReality-', '-APA-', '-ATLien-', '-Abnormal-', '-Ace_Rockolla-', '-Acerin', '-AcodeX', '-Aeryn-', '-Afrodisiac-', '-AgentMichaelScarn', '-Ahab-', '-Ai', '-Albus-', '-Alecat', '-AlexGrey-', '-Andar-', '-Anguscr4p-', '-Apocalypse-When-', '-Arcanity-', '-Argih', '-Arkennon', '-Arrow-', '-ArthurDent-', '-Aslan-', '-Avacyn', '-Avatar-Korra-', '-Axiom-', '-Axon-', '-Ayil-', '-Azax-', '-AznNinja-', '-B0X-', '-BEEFSQUATCH', '-BLAM', '-BMP-', '-BW-', '-BabbaBooey-', '-Babo97-', '-Bad-Mother-fucker-', '-Badger2-', '-Baker', '-Bana', '-Bashamo', '-Bathtub-Gin-', '-BearFucker-', '-Beren-', '-Best_Name_Ever-', '-Betch-', '-Beth-', '-BeyondWonderland-', '-Bi-Polar-Bear-', '-BiD-', '-Big_Test_Icicles-', '-BilboFraggins', '-Bingo-', '-BipBapBam-', '-BipolarPolarBear-', '-Bittersteel', '-Blackvein-', '-Blaka-', '-Blasko', '-BlitzN9ne', '-BlueJayway-', '-Borfo-', '-Brightraven', '-BushWacker-', '-Butt-Fumble-', '-C20H25N3O-', '-CA-', '-CK', '-CONTRABAND-', '-CORNADO-', '-CORRECT-MY-GRAMMAR-', '-C_R_E_A_M-', '-Caesar', '-CallMeMiss-', '-Canonical-', '-CassaNova-', '-Cerberus', '-Champloo-', '-Chareth-Cutestory', '-CharlieFoxtrot-', '-Chasing_Bacon-', '-Chinchillax-', '-ChowanChillin-', '-Clarity-', '-ClarkNova-', '-Clarkasaurus-', '-Clayton_Bigsby-', '-Cliche-', '-Col-', '-Colby', '-ComradeQuestions-', '-Coop-', '-Covariance', '-Cow_Tipper-', '-Crazy-World-', '-Crumb-', '-Cubes-', '-Cubix', '-Cubone-', '-Cutiepie-', '-Cwap', '-Cyy', '-DD', '-DDD-', '-DEAD-', '-DEMOCRACY-', '-Daetrax-', '-Damien-', '-Daniel', '-DannyDevito-', '-Dapper-Dan-', '-Dappertron-', '-Dargs', '-DarkNeko', '-DarkStar-', '-Dark_Link-', '-Davo', '-Dazed', '-DeadSpace', '-Deadzone-', '-Degaussed-', '-DeoxyRNA-', '-Derelict-', '-Desultor', '-Deuce-', '-Diatribe_6', '-Dillon-', '-DimensiO-', '-DinosaurX-', '-DisobedientAvocado-', '-Dissent', '-Domino-', '-DonQuixote-', '-DonnieDarko-', '-DontCrushMeFatty-', '-Doomcrow-', '-Dr-House-', '-Dr_Strangelove-', '-Dragin-', '-DrumDad', '-Duck-', '-Dys-', '-EViL-KoNCEPTz-', '-EW-', '-EasterEggs', '-El_Chapo-', '-ElectricKoolAid', '-Emberstorm', '-Energy', '-Enkara-', '-Epyx-', '-EverydayImRustlin-', '-Everynone-', '-EvilSpaceMonkey-', '-Exocoetidae-', '-Exquisite-', '-Exstasy', '-FC-', '-Fake', '-Falcyon-', '-Feartjeh', '-FedoraTheExplorer', '-FeistyRabbitSauce-', '-Fen-', '-Fender-', '-Fennekin-', '-FishPants', '-Flaming-Phenex-', '-Flossie-', '-Fluffmallow-', '-Fluffy', '-FluffyBunny', '-Fonzy-', '-Frank', '-FuckMe-', '-Fyrebrand', '-Gabe-', '-Gabria', '-GalacticaActual', '-Gamah', '-Gemeni', '-GenericBob-', '-GheeButtersnaps-', '-GirthControl-', '-Glitterous-', '-GoatNamedFelicia-', '-Googlrr', '-Goonzilla-', '-Graff-', '-GreenStar-', '-GregTheGreat-', '-Guyver89-', '-H-E-L-I-X-', '-H0B0-', '-HUSH-', '-H__H-', '-HarryManback-', '-Hastis-', '-Hawky-', '-Hegemon-', '-HelenOfTroy-', '-Hellfire-', '-Hellgirl-', '-High-C', '-HisDivineShadow-', '-Holmer13-', '-Hoopin-', '-Horhay-', '-HumorousWombat-', '-Hydrax-', '-I0I-', '-IAmEvil', '-IHaveNoGoddamnClue-', '-IIII--------IIII-', '-ILikePie-', '-INFEntropy', '-IZ-', '-I_AM_GROOT-', '-I__I__I__I__I-', '-Icaria-', '-Ignote-', '-Ihatefatpeople-', '-IllegalPill-', '-ImYourHuckleberry-', '-Imserious-', '-Indeed-', '-Influenza', '-InigoMontoya', '-Innovade', '-Interested-', '-IntoEternity-', '-IntoTheFray-', '-IntoTheVoid-', '-IoI-', '-IrishGunnerHD-', '-IronBorne-', '-J-P-', '-JAC', '-JDubs-', '-JEBUS_CRUST-', '-JI', '-JRMagnus', '-JS-', '-J_K_Fry', '-JaM--', '-Jackel-', '-Jagotron', '-Jaime-Lannister-', '-Jamerican', '-JamesAsner-', '-Japan', '-Jeebis-', '-Jeremiad-', '-Jim-Lahey', '-JimmyRustles', '-Jings-', '-Jinxy-', '-Jive-Turkey-', '-Jjb-', '-Joeta-', '-Joey-Wheeler-', '-John_D-', '-Johnny-', '-Josh', '-JuSt_My_LuCk', '-Just-Stop-', '-JustShy-', '-Just_Talk-', '-KILR0Y-', '-KR-', '-KarmaSlut', '-Karmavore', '-Kato', '-Kazuma', '-Kermit-', '-Ketracel-White', '-Kevin-', '-Khaleesi', '-KhmerBear-', '-Kilgore_Trout-', '-Kim-JongUn-', '-Kimi-', '-Knul-', '-Kryptic-', '-Kuroh-', '-L3G10N-', '-LEMONGRAB-', '-LOLOCAUST-', '-LS-', '-LaTeX-', '-Lampe-', '-LeZ-', '-Legendary-', '-Lemoncola-', '-Lemur', '-Lenny-Face-Bot-', '-Levi', '-Lo_Mein_Kampf-', '-Lolrax-', '-Lucario-', '-Lucky', '-Lukas-', '-Luthe-', '-MD-', '-MGP-', '-MK-Systems-', '-MONOL1TH', '-MOPPET-', '-MPG13-', '-MS-94-', '-MSP-', '-MURS-', '-MVP', '-M_K-', '-M_W', '-MaJiC-', '-MacCoy', '-Mad_Man-', '-MadameOvaries-', '-Madi-', '-MagicHands-', '-Magnum95-', '-Mahn', '-Malice', '-Manananggal-', '-MangoDown', '-MangoDown-', '-Mania-', '-MarcusD-', '-MarkTwang-', '-Mars', '-MaryQueenOfScotch-', '-Massachoosite', '-Master-Builder-', '-Mattwi', '-McLovin', '-Meanderthal-', '-MegaMan-', '-Megain-', '-Megrim-', '-MelonLord-', '-Metalithic-', '-Metamucil-', '-Micah-', '-Mikee', '-Mirgeaux-', '-Misla-', '-Miyata', '-Mockingbird', '-Moniker-', '-Monkey', '-Moonchild-', '-Mosski-', '-Mountain-King-', '-Mr-Papaya', '-MuffinTown-', '-MusicAndStuff', '-My-fap-account-', '-MyP0rnAccount-', '-MyUsername-', '-My_Other_Account-', '-Mythic-', '-N2O-', '-NAhL-', '-NS-', '-Nanites', '-Napoleonidas-', '-Narble-', '-Nature', '-NatureBoy-', '-Navajo-', '-NegativeZero-', '-Night_Wing-', '-Nihil-', '-Nii-', '-Nikolaus-', '-NlN-', '-No-One', '-NoFreeWill-', '-Norb', '-Nortrom-', '-Nostrus-', '-Not-An-Alt-', '-Novowels', '-Npie', '-OMGZOMBIES-', '-OPTHOMASPRIME-', '-OP_pls-', '-Oberlander', '-Obito-', '-Oc-', '-Oggy-', '-Oizys', '-Olek', '-OptimusPrimate-', '-OrangeLightning4', '-Orion-', '-Osiris-', '-Other_Barry-', '-OxO-', '-PC', '-PM_ME_YOUR_GENITALS', '-PSTV-ENRG-', '-PTM-', '-PUNCHCAT-', '-Paintsniffer-', '-Panther-', '-Pao', '-PaperbackWriter-', '-ParticleMan-', '-Pasha-', '-Patrick_Bateman-', '-Pelvis-', '-PetDetective-', '-PeterParker-', '-Pharetra-', '-PiLoT-', '-PiPo-', '-Pin_Cushion-', '-Pixelate', '-Pm_Me_Your_Pm-', '-Poe-', '-PokeMaster', '-Pollyanna', '-Polyphony-', '-PopeOfNope-', '-Posthuman-', '-PotatoMan-', '-Poverty-', '-Powdered-Toast-', '-Princeps-', '-Psychox', '-PurpleStain', '-QuestionMark-', '-R3DF0X', '-RAS', '-RNG-', '-ROCC-', '-RYknow', '-RaWnE_Larkin-', '-Ragnar', '-Ran', '-Rand-', '-Randi-', '-RandomPoem-', '-RandyMarsh', '-Rayko-', '-RdV-', '-Recluse-', '-RedFox', '-RedXIII-', '-Red_Forman-', '-RedditGuy', '-Rednal-', '-Reducto--', '-Reflux-', '-Reggin-', '-Rektangle-', '-Renton-', '-Replicated', '-Resist-', '-ReverendX-', '-Rhombus-', '-Richard', '-Right_In_The_Feels', '-Riko', '-RiskManagement-', '-Rivox-', '-Rizhiy-', '-Rob', '-Rum-Ham-', '-Runaway', '-Runki-', '-Ryu-', '-SD-', '-SG', '-SHOCKDIZZLE-', '-SPADED-', '-SPIRITUAL-GANGSTER-', '-SPN', '-SSS-', '-STEW-', '-STFU_DONNY-', '-SagaQ-', '-Saggio-', '-Sah-', '-Sai-', '-SaidNoOneEver-', '-Saki', '-Sam-R-', '-Sambuca-', '-Saraei-', '-SayWhatAgain-', '-Schwang-', '-ScubaSteve', '-Senjougahara-', '-Seraph', '-SgtFrog-', '-Shade', '-Shadowphoenix-', '-ShaiHulud', '-Shank-', '-Sharad-', '-Sharles-', '-Shenanigans', '-Shenanigasm-', '-Shirley-', '-ShootMeNow-', '-Shooter-McGavin-', '-Shooter_McGavin-', '-Simba', '-SingularSoul-', '-Skaboomatude', '-Skir-', '-Sloth', '-Slunk', '-Slutlord-Fascist-', '-Smacky-the-Frog-', '-Sneaky', '-Snow-', '-SnowMan-', '-SoItGoes', '-SofaKing-', '-Soto', '-SowLo-', '-SpaceCommunist-', '-SpaceGh0st-', '-Spider-Man-', '-Squidster-', '-StJimmy-', '-Stackdaddy-', '-SteinCr', '-StevieJanowski-', '-StopRefresh-', '-Strider', '-StripMyMind-', '-Stupendous-Man-', '-Sty-', '-SuPerNoVi-', '-SubZer000z', '-SuicideThrowaway-', '-Sunshiner-', '-Suzuka-', '-Swade-', '-SwedishGuy-', '-Swifty', '-Synergy-', '-Syphon-', '-Sythen-', '-THATONE', '-THE_BIG_BOSS-', '-TUX-', '-TaborlinTheGreat-', '-Tazriel', '-Teekey-', '-Tellos-', '-Tendo-', '-Terriermon-', '-Tesserex-', '-ThatGuyHere', '-ThatGuyOnReddit', '-The-Matador-', '-TheCabbageMerchant-', '-TheDeadGuy-', '-TheDevilsAssistant-', '-TheDoctor', '-TheDude', '-TheLethalAlphX-', '-TheMAXX-', '-TheNinthDoctor-', '-TheRowAway-', '-TheTechGuy-', '-TheToad-', '-TheWaddleWaddle-', '-TheWanderer-', '-TheWarOnHugs', '-TheWindBlows-', '-TheWrongThingToSay-', '-The_Blazer-', '-The_Cunning_Stunt-', '-The_Survivor-', '-Theis', '-Themis-', '-ThingOfGold-', '-ThisUsernameIsTaken', '-Thomas_Jefferson-', '-ThrowawayEMT-', '-Thunderbear-', '-Tiger-', '-Time-', '-TinMan-', '-ToTheWorld-', '-ToasT_', '-Token', '-Tom-', '-Tommy', '-Toshi', '-Trans-Am-', '-Travis-', '-Tree', '-Trips', '-TrustMeImADoctor-', '-TwistedElegance-', '-Umbra-', '-Umbrakinesis', '-UnclaimedPants-', '-Unknown_', '-Unorthodox-', '-Unparalleled-', '-Unproductive-', '-Untitled-', '-Urbex-', '-Urethra-', '-UrsaMajor-', '-UserNameTaken', '-VaL-', '-Vanisher-', '-VempirE', '-Venser-', '-VeridisQuo', '-Vertex-', '-ViceGrip-', '-Villarreal-', '-VincentVega-', '-Volumes_', '-WAwesome-', '-WB-Spitfire', '-WISCONSIN-', '-WPD-', '-WeepingAngel-', '-WhenTheyCry-', '-Wicked3Studios-', '-WienerPoop-', '-Wiggles-', '-WildCat-', '-Wildboyz-', '-Wolodarsky', '-Worldonfire-', '-XDerekX-', '-XIII-', '-Xerra-', '-Xordis-', '-Y0-', '-Yngin-', '-YouWontLikeIt', '-ZOU-', '-Zacast-', '-Zaydan-', '-Zenith-', '-ZeroStatic-', '-Zloy-', '-Zonz-', '-Zoobe', '-Zoomacroom-', '-_--___-_--_--___--_', '-_-BanditGirl-_-', '-_-C21H30O2-_-', '-_-Edit_Deleted-_-', '-_-HammockLand-_-', '-_-Hamodi', '-_-Mikool-_-', '-_-Zach-_-', '-_-_-_-_-_-_-_-_--', '-_-_-_-__-_-_-_-', '-_-__---__-', '-_-__-_-_-__-_-', '-_-anonymous', '-_-neohugh', '-_-recalculating-_-', '-_Dan_-', '-_Drasher_-', '-_Guts_-', '-_ICANTREAD-_', '-_Jim_-', '-_Odd_-', '-_Sunny5_-', '-_Trashboat', '-__---____-----', '-__-_', '-___-___-', '-_____DEADPOOL_____-', '-_dracarys', '-_l_-l_-_-_', '-_smalls_-', '-_x', '-adaptive', '-aes', '-aether-', '-aimless-', '-airborne-', '-amiibo-', '-ana', '-anne-marie-', '-ap', '-apple-', '-arKK', '-atheos', '-aurelius', '-baabaa_blacksheep-', '-bananabread-', '-bicurious-', '-blah', '-blank', '-blue-eyes-', '-bluebat-', '-bojangles', '-bolo-', '-bonesaw-', '-boredatwork', '-bornlivedie-', '-butts', '-buz', '-c0de-', '-c3h5n3o9-', '-captainamerica-', '-castiel', '-ce11ar-', '-citylights', '-clownbaby', '-com_BATMAN-', '-cookie-monsta-', '-crave', '-cupcake', '-cutestofborg-', '-cutigers', '-cyan', '-danceinthegraveyard', '-dead_slender-', '-deadking-', '-del2phi', '-delete-', '-delta-9-', '-derpsky-', '-deteled-', '-devonjones', '-dingus', '-discostu-', '-dmnk-', '-do_not_resuscitate-', '-dolantello-', '-dont-believe-me', '-doob-', '-doom', '-doughboy', '-drbadass-', '-drunkenmaster', '-dsp-', '-dudeomfgstfux-', '-dujek-', '-dusk-', '-eagle73', '-earthmover', '-effort-', '-eku-', '-elaborate-scheme-', '-ellipsys-', '-eltopo', '-emkay-', '-emmie-', '-entropy', '-entropy-', '-er', '-error37', '-evan', '-fd-', '-ferrocactus', '-fluffs', '-forbidden', '-fuck-off-loser-', '-fuckyouthatswhy-', '-fuzzyd-', '-generic-username-', '-gh0stRush-', '-ghostinthemachine-', '-gold99999', '-goocher-', '-good-', '-guanaco', '-gurgle-', '-halcyon', '-hankscorpio', '-harlequin', '-haven', '-headRUSH', '-heathcliffe-', '-herekitty_kitty-', '-hh', '-highpriestessoftea-', '-holocene', '-hondo-', '-honest', '-hummingbird-', '-hx', '-iMysticWolf', '-iNfluence', '-iRegretNothing-', '-iambatman-', '-idk', '-ilikesnow-', '-insert_user-', '-insignificant-', '-internets', '-intrigued', '-ipseDixit-', '-iusedtobecool', '-ixto-', '-izac-', '-jabberwock', '-jackschitt-', '-jub-', '-juice', '-jwo-', '-jz', '-katekiko', '-kazken-', '-kel-', '-kellam-', '-kenji', '-kenny-', '-kenobi-', '-kippin-', '-klassy-', '-kodoku-', '-komorebi-', '-kunai', '-kvothe-', '-kwee-', '-l0tus-', '-lTNA', '-landtank', '-lifestronaut-', '-lightfury-', '-lillian-', '-liquidcooled-', '-littlefang-', '-ll--squat--ll-', '-lll-------lll-', '-lol_lol-', '-lovehate', '-lumpinator-', '-lyrota-', '-m4rWyn-', '-magilla-', '-main', '-maker', '-malacath-', '-malloc', '-malpa-', '-manabreak', '-manny_calavera-', '-masterballs-', '-mattybatty-', '-mb-', '-mbartlett', '-melomane-', '-mickomoo-', '-miguel-', '-mikew-', '-momoyome-', '-moose-', '-motts-', '-mousey-', '-muse', '-negative_creep-', '-no-signal-', '-nobu_oKo_jima-', '-nofriends-', '-northlondonisred', '-not-a-doctor-', '-not-pennys-boat-', '-notthesun-', '-novac-', '-nox-', '-nyx-', '-nz-', '-o-Y-o-Y-o-Y-o-Y', '-o-o-o', '-o-o-o-o-0-o-o-o-o-', '-oO0Oo-', '-oOoOoOoOoOoOoOoOo-', '-oWs-LordEnigma', '-ogre-', '-ol_l-l_lo-', '-oligodendrocyte-', '-oliver-queen-', '-onionknight-', '-oooooooh-', '-ooottafvgvah', '-openTarget-', '-orangejoe', '-oshino_shinobu-', '-otters-', '-out', '-pANIC-']

authorReg = ' OR '.join("author IS '" + testAuthor + "'" for testAuthor in testAuthors)

query = """
    SELECT
      author
      , subreddit
      , count(*) as nbComment
    FROM May2015
    WHERE
       author IN (
            SELECT
                author
            FROM
                May2015
            WHERE 
                NOT ({:s})
            GROUP BY author
            HAVING count(DISTINCT subreddit)  > 10
            AND count(DISTINCT parent_id) < 3000
            LIMIT 50000
            OFFSET ABS(RANDOM()) % 5)
    GROUP BY author, subreddit""".format(authorReg)

df = pd.read_sql(query, sql_conn)

df.to_csv('UtilityMatrix.csv', encoding='utf-8', index=False)